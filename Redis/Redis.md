# Redis

## 持久化

利用永久性存储介质将数据进行保存，在特定的时间将保存的数据进行恢复的工作机制称为持久化。

目的：防止数据的意外丢失，确保数据安全性

- 将当前数据状态进行保存，快照形式，存储数据结果，存储格式简单，关注点在数据
- 将数据的操作过程进行保存，日志形式，存储操作过程，存储格式复杂，关注点在数据的操作过程

### RDB

- 命令

> save

- 作用

  手动执行一次保存操作

**RDB启动方式-save指令相关配置**

- Dbfilename dump.rdb 设置本地数据库的文件名，默认值为dump.rdb
- dir 设置存储.rdb文件的路径
- rdbcompression yes 设置存储至本地数据库时是否压缩数据，默认yes，采用LZF压缩
- rdbchecksum yes 设置是否进行RDB文件格式校验，该校验过程在写文件和读文件过程均进行

**注意**：save指令的执行会阻塞当前redis服务器，直到当前RDB过程完成为止，有可能会造成长时间阻塞，线上环境不建议使用。

**注意**：bgsave命令是针对save阻塞问题做的优化，redis内部所有涉及RDB操作都采用bgsave的方式，save命令可以放弃使用。

- 配置

> save second changes

- 作用

  满足限定时间范围内key的变化数量达到指定数量即进行持久化

- 参数

  seconds：监控时间范围

  changes：监控key的变化量

**RDB三种启动方式对比**

| 方式           | save指令 | bgsave指令 |
| -------------- | -------- | ---------- |
| 读写           | 同步     | 异步       |
| 阻塞客户端指令 | 是       | 否         |
| 额外内存消耗   | 否       | 是         |
| 启动新进程     | 否       | 是         |

### AOF

RDB存储的弊端

- 存储数据量较大，效率较低
- 大数据量下的IO性能较低
- 基于fork创建子进程，内存产生额外消耗
- 宕机带来的数据丢失风险

